#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
VADER 7.0 UNIVERSAL DEMO INTERACTIVO

Demo interactivo que muestra todos los runtimes de Vader 7.0 en acci√≥n,
permitiendo al usuario probar diferentes plataformas y ver la ejecuci√≥n
nativa de archivos .vdr en tiempo real.

Caracter√≠sticas:
- Interfaz interactiva en terminal
- Ejemplos predefinidos para cada runtime
- Ejecuci√≥n en tiempo real
- M√©tricas de rendimiento
- Comparaci√≥n entre runtimes

Autor: Vader Universal Runtime Team
Versi√≥n: 7.0.0 Universal Demo Enhanced
Fecha: Julio 2025
"""

import sys
import os
import time
import subprocess
import json
from pathlib import Path
from typing import Dict, List, Optional, Tuple
from datetime import datetime
import tempfile

# Configuraci√≥n del demo
VADER_VERSION = "7.0.0"
DEMO_VERSION = "1.0.0"
VADER_SLOGAN = "LA PROGRAMACI√ìN UNIVERSAL: Libre, Descentralizada, Accesible"

class VaderUniversalDemo:
    """Demo Interactivo Universal para Vader 7.0"""
    
    def __init__(self):
        self.version = VADER_VERSION
        self.demo_version = DEMO_VERSION
        self.slogan = VADER_SLOGAN
        
        # Ejemplos de c√≥digo .vdr para cada runtime
        self.examples = {
            'python': {
                'name': 'üêç Python Enhanced',
                'description': 'Aplicaci√≥n web con Flask y an√°lisis de datos',
                'code': '''// Vader 7.0 - Aplicaci√≥n Python Enhanced
configurar servidor web flask
crear api rest "/datos"
mostrar dashboard con pandas
procesar datos csv
generar gr√°ficos matplotlib
ejecutar an√°lisis estad√≠stico
'''
            },
            'javascript': {
                'name': 'üü® JavaScript Enhanced',
                'description': 'Aplicaci√≥n React con componentes interactivos',
                'code': '''// Vader 7.0 - Aplicaci√≥n React Enhanced
crear componente react "Dashboard"
mostrar header navegaci√≥n
configurar estado con hooks
fetch datos api externa
renderizar tabla interactiva
manejar eventos click
'''
            },
            'iot': {
                'name': 'ü§ñ IoT Enhanced',
                'description': 'Sistema Arduino con sensores y actuadores',
                'code': '''// Vader 7.0 - Sistema IoT Enhanced
configurar arduino uno
leer sensor temperatura dht22 pin 2
leer sensor humedad dht22 pin 2
controlar led rgb pin 9
activar buzzer pin 8
mostrar datos serial monitor
'''
            },
            'cloud': {
                'name': '‚òÅÔ∏è Cloud Enhanced',
                'description': 'API serverless en AWS Lambda',
                'code': '''// Vader 7.0 - API Cloud Enhanced
crear funci√≥n lambda handler
configurar api gateway
conectar database dynamodb
implementar autenticaci√≥n jwt
procesar requests http
responder json formato
'''
            },
            'ai': {
                'name': 'üß† AI Universal',
                'description': 'Integraci√≥n con modelos de IA',
                'code': '''// Vader 7.0 - Sistema AI Universal
configurar modelo openai gpt-4
crear prompt an√°lisis texto
procesar respuesta ia
generar resumen autom√°tico
traducir m√∫ltiples idiomas
mostrar resultados json
'''
            },
            'mobile': {
                'name': 'üì± Mobile Universal',
                'description': 'App m√≥vil multiplataforma',
                'code': '''// Vader 7.0 - App Mobile Universal
crear app react native
configurar navegaci√≥n stack
mostrar pantalla login
implementar formulario
conectar api backend
guardar datos locales
'''
            },
            'gaming': {
                'name': 'üéÆ Gaming Universal',
                'description': 'Juego 2D con Unity',
                'code': '''// Vader 7.0 - Juego Gaming Universal
crear escena unity 2d
configurar personaje player
implementar movimiento wasd
detectar colisiones
mostrar puntuaci√≥n ui
reproducir efectos sonido
'''
            },
            'blockchain': {
                'name': '‚õìÔ∏è Blockchain Universal',
                'description': 'Smart contract en Ethereum',
                'code': '''// Vader 7.0 - Blockchain Universal
crear contrato ethereum
definir token erc20
implementar funci√≥n transfer
configurar eventos logs
desplegar red testnet
interactuar web3 js
'''
            }
        }
        
        # M√©tricas de rendimiento
        self.metrics = {}
        
        print(f"üöÄ VADER {self.version} - Demo Universal Enhanced v{self.demo_version}")
        print(f"‚ö° {self.slogan}")
        print()
    
    def show_welcome(self):
        """Muestra la pantalla de bienvenida"""
        print("="*70)
        print("üåü BIENVENIDO AL DEMO INTERACTIVO DE VADER 7.0 UNIVERSAL RUNTIME")
        print("="*70)
        print()
        print("Este demo te permite explorar todos los runtimes de Vader 7.0 y ver")
        print("c√≥mo los archivos .vdr se ejecutan nativamente en diferentes contextos:")
        print()
        print("üåü RUNTIMES ENHANCED (Auditados y Mejorados):")
        print("   ‚Ä¢ Python Enhanced - Aplicaciones web y an√°lisis de datos")
        print("   ‚Ä¢ JavaScript Enhanced - Aplicaciones React y Node.js")
        print("   ‚Ä¢ IoT Enhanced - Dispositivos Arduino y Raspberry Pi")
        print("   ‚Ä¢ Cloud Enhanced - Funciones serverless AWS/Vercel/Netlify")
        print()
        print("üì¶ RUNTIMES UNIVERSALES (Funcionales):")
        print("   ‚Ä¢ AI Universal - Integraci√≥n con modelos de IA")
        print("   ‚Ä¢ Mobile Universal - Apps iOS/Android multiplataforma")
        print("   ‚Ä¢ Gaming Universal - Videojuegos Unity/Godot")
        print("   ‚Ä¢ Blockchain Universal - Smart contracts y Web3")
        print("   ‚Ä¢ Y muchos m√°s...")
        print()
        print("üéØ Cada ejemplo muestra:")
        print("   ‚úÖ Ejecuci√≥n nativa sin transpilaci√≥n")
        print("   ‚úÖ Preservaci√≥n de identidad .vdr")
        print("   ‚úÖ Detecci√≥n autom√°tica de contexto")
        print("   ‚úÖ Generaci√≥n de c√≥digo espec√≠fico")
        print("   ‚úÖ M√©tricas de rendimiento")
        print()
        print("="*70)
        input("Presiona ENTER para continuar...")
        print()
    
    def show_menu(self) -> str:
        """Muestra el men√∫ principal y retorna la opci√≥n seleccionada"""
        print("üéØ MEN√ö PRINCIPAL - DEMO VADER 7.0 UNIVERSAL")
        print("="*50)
        print()
        
        options = list(self.examples.keys())
        
        for i, (key, example) in enumerate(self.examples.items(), 1):
            status = "üåü" if key in ['python', 'javascript', 'iot', 'cloud'] else "üì¶"
            print(f"{i:2}. {status} {example['name']}")
            print(f"     {example['description']}")
            print()
        
        print(f"{len(options)+1:2}. üìä Ver m√©tricas de rendimiento")
        print(f"{len(options)+2:2}. üîÑ Ejecutar benchmark completo")
        print(f"{len(options)+3:2}. ‚ùì Ayuda y documentaci√≥n")
        print(f"{len(options)+4:2}. üö™ Salir")
        print()
        
        while True:
            try:
                choice = input("Selecciona una opci√≥n (1-{}): ".format(len(options)+4))
                
                if choice.isdigit():
                    choice_num = int(choice)
                    if 1 <= choice_num <= len(options):
                        return options[choice_num - 1]
                    elif choice_num == len(options) + 1:
                        return 'metrics'
                    elif choice_num == len(options) + 2:
                        return 'benchmark'
                    elif choice_num == len(options) + 3:
                        return 'help'
                    elif choice_num == len(options) + 4:
                        return 'exit'
                
                print("‚ùå Opci√≥n inv√°lida. Intenta de nuevo.")
                
            except (ValueError, KeyboardInterrupt):
                print("‚ùå Entrada inv√°lida. Intenta de nuevo.")
    
    def create_temp_vdr_file(self, code: str) -> str:
        """Crea un archivo .vdr temporal con el c√≥digo"""
        with tempfile.NamedTemporaryFile(mode='w', suffix='.vdr', delete=False, encoding='utf-8') as f:
            f.write(code)
            return f.name
    
    def execute_runtime_demo(self, runtime_key: str):
        """Ejecuta un demo espec√≠fico de runtime"""
        example = self.examples[runtime_key]
        
        print(f"\nüöÄ EJECUTANDO DEMO: {example['name']}")
        print("="*60)
        print(f"üìù Descripci√≥n: {example['description']}")
        print()
        print("üìÑ C√≥digo .vdr:")
        print("-"*40)
        print(example['code'])
        print("-"*40)
        print()
        
        # Crear archivo temporal
        temp_file = self.create_temp_vdr_file(example['code'])
        
        try:
            print("‚è≥ Ejecutando con CLI Universal...")
            print()
            
            # Usar el CLI universal para ejecutar
            cli_path = Path("vader-cli-universal.py")
            if not cli_path.exists():
                print("‚ùå CLI Universal no encontrado. Aseg√∫rate de estar en el directorio correcto.")
                return
            
            # Determinar plataforma por defecto para cada runtime
            platform_map = {
                'python': 'python',
                'javascript': 'react',
                'iot': 'arduino',
                'cloud': 'aws_lambda',
                'ai': 'openai',
                'mobile': 'react_native',
                'gaming': 'unity',
                'blockchain': 'ethereum'
            }
            
            platform = platform_map.get(runtime_key, 'python')
            
            # Ejecutar comando
            start_time = time.time()
            
            cmd = ['python3', str(cli_path), temp_file, platform]
            result = subprocess.run(cmd, capture_output=True, text=True)
            
            execution_time = time.time() - start_time
            
            # Mostrar resultados
            if result.stdout:
                print(result.stdout)
            
            if result.stderr:
                print("‚ö†Ô∏è Advertencias:")
                print(result.stderr)
            
            # Guardar m√©tricas
            self.metrics[runtime_key] = {
                'execution_time': execution_time,
                'success': result.returncode == 0,
                'timestamp': datetime.now().isoformat(),
                'platform': platform
            }
            
            print("="*60)
            print(f"‚è±Ô∏è Tiempo de ejecuci√≥n: {execution_time:.3f}s")
            print(f"üéØ Estado: {'‚úÖ √âXITO' if result.returncode == 0 else '‚ùå ERROR'}")
            print(f"üöÄ Plataforma: {platform}")
            
            if result.returncode == 0:
                print("üéâ ¬°Demo ejecutado exitosamente!")
                print("‚ö° Archivo .vdr ejecutado nativamente sin transpilaci√≥n")
            else:
                print("üí• Error en la ejecuci√≥n del demo")
            
        except Exception as e:
            print(f"‚ùå Error ejecutando demo: {str(e)}")
            
        finally:
            # Limpiar archivo temporal
            try:
                os.unlink(temp_file)
            except:
                pass
        
        print()
        input("Presiona ENTER para continuar...")
    
    def show_metrics(self):
        """Muestra m√©tricas de rendimiento"""
        print("\nüìä M√âTRICAS DE RENDIMIENTO")
        print("="*50)
        
        if not self.metrics:
            print("‚ùå No hay m√©tricas disponibles. Ejecuta algunos demos primero.")
            print()
            input("Presiona ENTER para continuar...")
            return
        
        print()
        print(f"{'Runtime':<15} {'Plataforma':<15} {'Tiempo (s)':<12} {'Estado':<8}")
        print("-"*50)
        
        total_time = 0
        success_count = 0
        
        for runtime, metrics in self.metrics.items():
            status = "‚úÖ OK" if metrics['success'] else "‚ùå ERROR"
            print(f"{runtime:<15} {metrics['platform']:<15} {metrics['execution_time']:<12.3f} {status}")
            
            total_time += metrics['execution_time']
            if metrics['success']:
                success_count += 1
        
        print("-"*50)
        print(f"üìä RESUMEN:")
        print(f"   Demos ejecutados: {len(self.metrics)}")
        print(f"   Exitosos: {success_count}")
        print(f"   Tiempo total: {total_time:.3f}s")
        print(f"   Tiempo promedio: {total_time/len(self.metrics):.3f}s")
        print(f"   Tasa de √©xito: {success_count/len(self.metrics)*100:.1f}%")
        
        print()
        input("Presiona ENTER para continuar...")
    
    def run_benchmark(self):
        """Ejecuta un benchmark completo de todos los runtimes"""
        print("\nüîÑ EJECUTANDO BENCHMARK COMPLETO")
        print("="*50)
        print("‚è≥ Esto ejecutar√° todos los runtimes disponibles...")
        print()
        
        confirm = input("¬øContinuar? (s/N): ").lower().strip()
        if confirm != 's':
            return
        
        print("\nüöÄ Iniciando benchmark...")
        
        # Limpiar m√©tricas anteriores
        self.metrics.clear()
        
        # Ejecutar cada runtime
        for i, runtime_key in enumerate(self.examples.keys(), 1):
            print(f"\n[{i}/{len(self.examples)}] Ejecutando {self.examples[runtime_key]['name']}...")
            
            # Versi√≥n silenciosa del execute_runtime_demo
            example = self.examples[runtime_key]
            temp_file = self.create_temp_vdr_file(example['code'])
            
            try:
                cli_path = Path("vader-cli-universal.py")
                platform_map = {
                    'python': 'python',
                    'javascript': 'react',
                    'iot': 'arduino',
                    'cloud': 'aws_lambda',
                    'ai': 'openai',
                    'mobile': 'react_native',
                    'gaming': 'unity',
                    'blockchain': 'ethereum'
                }
                
                platform = platform_map.get(runtime_key, 'python')
                
                start_time = time.time()
                cmd = ['python3', str(cli_path), temp_file, platform]
                result = subprocess.run(cmd, capture_output=True, text=True)
                execution_time = time.time() - start_time
                
                self.metrics[runtime_key] = {
                    'execution_time': execution_time,
                    'success': result.returncode == 0,
                    'timestamp': datetime.now().isoformat(),
                    'platform': platform
                }
                
                status = "‚úÖ" if result.returncode == 0 else "‚ùå"
                print(f"   {status} {execution_time:.3f}s")
                
            except Exception as e:
                print(f"   ‚ùå Error: {str(e)}")
                self.metrics[runtime_key] = {
                    'execution_time': 0,
                    'success': False,
                    'timestamp': datetime.now().isoformat(),
                    'platform': platform
                }
            
            finally:
                try:
                    os.unlink(temp_file)
                except:
                    pass
        
        print("\nüéâ Benchmark completado!")
        self.show_metrics()
    
    def show_help(self):
        """Muestra ayuda y documentaci√≥n"""
        print("\n‚ùì AYUDA Y DOCUMENTACI√ìN")
        print("="*50)
        print()
        print("üéØ SOBRE ESTE DEMO:")
        print("   Este demo interactivo muestra las capacidades de Vader 7.0")
        print("   Universal Runtime, permitiendo ejecutar archivos .vdr nativamente")
        print("   en m√∫ltiples contextos tecnol√≥gicos sin transpilaci√≥n.")
        print()
        print("üåü RUNTIMES ENHANCED:")
        print("   Los runtimes marcados con üåü han sido auditados y mejorados")
        print("   con arquitectura robusta, validaci√≥n autom√°tica y m√©tricas.")
        print()
        print("üì¶ RUNTIMES UNIVERSALES:")
        print("   Los runtimes marcados con üì¶ son funcionales y est√°n")
        print("   pendientes de migraci√≥n al patr√≥n Enhanced.")
        print()
        print("üîß CARACTER√çSTICAS:")
        print("   ‚Ä¢ Detecci√≥n autom√°tica de contexto y idioma")
        print("   ‚Ä¢ Validaci√≥n robusta de archivos .vdr")
        print("   ‚Ä¢ Generaci√≥n de c√≥digo espec√≠fico por plataforma")
        print("   ‚Ä¢ Preservaci√≥n total de identidad .vdr")
        print("   ‚Ä¢ M√©tricas de rendimiento en tiempo real")
        print()
        print("üìö DOCUMENTACI√ìN:")
        print("   ‚Ä¢ README.md - Gu√≠a de inicio")
        print("   ‚Ä¢ AUDITORIA_RUNTIMES_ENHANCED.md - Detalles t√©cnicos")
        print("   ‚Ä¢ https://github.com/LangVader/core - Repositorio oficial")
        print()
        print("üõ†Ô∏è COMANDOS CLI:")
        print("   vader --help                    # Ayuda del CLI")
        print("   vader archivo.vdr               # Detecci√≥n autom√°tica")
        print("   vader archivo.vdr plataforma    # Plataforma espec√≠fica")
        print("   vader --list                    # Listar plataformas")
        print()
        input("Presiona ENTER para continuar...")
    
    def run(self):
        """Ejecuta el demo interactivo"""
        try:
            self.show_welcome()
            
            while True:
                choice = self.show_menu()
                
                if choice == 'exit':
                    print("\nüëã ¬°Gracias por probar Vader 7.0 Universal Runtime!")
                    print("‚ö° LA PROGRAMACI√ìN UNIVERSAL: Libre, Descentralizada, Accesible")
                    print("üéØ Para m√°s informaci√≥n: https://github.com/LangVader/core")
                    break
                elif choice == 'metrics':
                    self.show_metrics()
                elif choice == 'benchmark':
                    self.run_benchmark()
                elif choice == 'help':
                    self.show_help()
                elif choice in self.examples:
                    self.execute_runtime_demo(choice)
                else:
                    print("‚ùå Opci√≥n no v√°lida")
                
                print()
                
        except KeyboardInterrupt:
            print("\n\nüõë Demo interrumpido por el usuario")
            print("üëã ¬°Gracias por probar Vader 7.0!")
        except Exception as e:
            print(f"\nüí• Error en el demo: {str(e)}")

def main():
    """Funci√≥n principal"""
    try:
        demo = VaderUniversalDemo()
        demo.run()
        return 0
    except Exception as e:
        print(f"üí• Error fatal: {str(e)}")
        return 1

if __name__ == "__main__":
    sys.exit(main())
